pipeline{
agent any
                  tools{
                     maven 'maven3'
                  }

                                     stages{
                                                      stage('maven build'){
                                                        steps{
                                                            sh "mvn clean package"
                                                       }
                                                }
                                                   stage('Docker build image'){
                                                             steps{
                                                               sh "docker build -t jyothihomedocker/2021myapp:v3 . "
                                                             }
                                                   }
                                                        stage('Push to Docker Hub'){
                                                                steps{
                                                                      withCredentials([string(credentialsId: 'docker-hub-new', variable: 'dockerpwd')]) {
                                                                                    sh "docker login -u jyothihomedocker -p ${dockerpwd}"
                                                                                    sh "docker push jyothihomedocker/2021myapp:v3"
                                                                                }
                                                                }

                                                           }

                                                        stage('dev-deploy'){
                                                                steps{
                                                                    sshagent(['docker_host_dev']) {
                                                                              sh "ssh -o StrictHostKeyChecking=no ec2-user@172.31.50.204 docker rm -f mywebapp"
                                                                               sh "ssh -o StrictHostKeyChecking=no ec2-user@172.31.50.204 docker run -d -p 9090:8080 --name mywebapp jyothihomedocker/2021myapp:v3" 
                                                                            }
                                                                                
                                                             
                                                                 }
                                                        }
                                    }

}
