pipeline{
agent any
                  tools{
                     maven 'maven3'
                  }

                                     stages{
                                                      stage('maven build'){
                                                        steps{
                                                            sh "mvn clean package"
                                                       }
                                                }
                                                   stage('Docker build image'){
                                                             steps{
                                                               sh "docker build -t jyothihomedocker/2021myapp:v1 . "
                                                             }
                                                   }
                                                        stage('Push to Docker Hub'){
                                                                steps{
                                                                      withCredentials([string(credentialsId: 'docker-hub', variable: 'dockerpass')]) {
                                                                                        sh   "docker login -u jyothihomedocker -p ${dockerpass}"
                                                                                        sh "docker push jyothihomedocker/2021myapp:v1"
                                                                                     }
                                                                }

                                                           }

                                                        stage('dev-deploy'){
                                                                steps{
                                                                      sshagent(['docker-dev']) {
                                                                                 sh "ssh -o StrictHostKeyChecking=no ec2-user@54.227.106.200 docker run -d -p 9080:8080 jyothihomedocker/2021myapp:v1"
                                                                                }
                                                             
                                                                 }
                                                        }
                                    }

}
